{% load static %}
{% block content %}

<!-- ðŸŒ Feuilles de style -->
<link rel="stylesheet" href="{% static 'css/formulaire.css' %}">
<link rel="stylesheet" href="{% static 'css/sidebar.css' %}">

<!-- ðŸ”˜ Bouton toggle sidebar -->
<button class="toggle-sidebar-btn" id="toggleSidebar" title="Afficher/masquer le menu">â˜°</button>

<!-- ðŸ§± Conteneur principal -->
<div class="layout" id="layout">

  <!-- ==================== -->
  <!-- ðŸ“‚ Sidebar Ã  gauche : Import Excel et Formulaire Graphique -->
  <!-- ==================== -->
  <div class="excel-sidebar" id="sidebar">
    <h2>ðŸ“‚ Importer Excel</h2>

    <!-- Formulaire d'upload Excel -->
    <form id="excel-upload-form" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="file" name="excel_file" id="excel-file" accept=".xlsx" required>
    </form>

    <!-- Formulaire pour enregistrer le graphique -->
    <form method="post" action="{% url 'creer_graphique_excel' slug=slug %}">
      {% csrf_token %}

      <!-- Colonnes Excel dÃ©tectÃ©es -->
      <div id="colonnes-container" class="hidden"></div>

      <!-- Champs principaux -->
      <label for="id_titre">Titre :</label>
      <input type="text" name="titre" id="id_titre" required>

      <label for="id_type">Type de graphique :</label>
      <select name="type" id="id_type">
        <option value="bar" selected>Barres</option>
        <option value="line">Lignes</option>
        <option value="pie">Camembert</option>
        <option value="doughnut">Doughnut</option>
      </select>

      <label for="id_description">Description :</label>
      <textarea name="description" id="id_description" rows="3"></textarea>

      <label for="titre-x">Titre axe X :</label>
      <input type="text" name="titre-x" id="titre-x">

      <label for="titre-y">Titre axe Y :</label>
      <input type="text" name="titre-y" id="titre-y">

      <!-- Stockage JSON des sÃ©ries -->
      <input type="hidden" name="series_data" id="series-data-json">

      <!-- Bouton de sauvegarde -->
      <button type="submit" class="submit-btn">âœ… Enregistrer le graphique</button>
    </form>
  </div>

  <!-- ==================== -->
  <!-- ðŸ“Š Zone de prÃ©visualisation Ã  droite -->
  <!-- ==================== -->
  <div class="excel-main">

    <!-- ðŸŒŸ Bloc d'options supplÃ©mentaires -->
<div id="preview-options" style="margin-bottom: 20px;">
  <h4>Options d'affichage :</h4>

  <label>
    <input type="checkbox" id="toggle-legend" checked> Afficher la lÃ©gende
  </label><br>

  <label>
    <input type="checkbox" id="toggle-labels" checked> Afficher les labels
  </label><br>

  <label>
    <input type="checkbox" id="toggle-percent"> Ajouter % aux valeurs
  </label><br>

  <!-- ðŸŽ¯ Option pour afficher/ajouter un axe secondaire -->
  <div id="toggle-second-axis-container" style="display: none; margin-top: 10px;">
    <label>
      <input type="checkbox" id="toggle-second-axis"> Ajouter un axe secondaire (droite)
    </label>
  </div>

  <!-- ðŸŽ¯ Options par sÃ©rie gÃ©nÃ©rÃ©es dynamiquement -->
  <h4 style="margin-top: 20px;">Options par sÃ©rie :</h4>
  <div id="series-options-container">
    <!-- Les choix par sÃ©rie (Axe gauche/droite) seront injectÃ©s ici en JS -->
  </div>

</div>

<!-- ðŸŽ¯ Canvas de prÃ©visualisation du graphique -->
<canvas id="preview-chart"></canvas>


  </div>

</div>

<!-- ==================== -->
<!-- ðŸ”¥ Scripts utilisÃ©s -->
<!-- ==================== -->
<script src="{% static 'js/sidebar.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="{% static 'js/import_excel.js' %}"></script>

{% endblock %}
