{% extends "base.html" %}
{% load static %}

{% block title %}Ajouter un graphique{% endblock %}

{% block content %}
<!-- Mode JS : ADD -->
<div id="mode" data-mode="add" hidden></div>
<link rel="stylesheet" href="{% static 'css/insee.css' %}">

<!-- üí° Wrapper en 2 colonnes -->
<div class="graph-builder">
    <!-- üìã Formulaire (sidebar) -->
    <div class="sidebar">
        <h4>Ajouter un graphique √† {{ sous_thematique.nom }}</h4>

        <!-- Message d'avertissement -->
        <div id="chart-warning" class="alert-box" style="display: none;">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <div class="alert-content">
                <strong>Error</strong><br>
                Le type "camembert" n'accepte qu'une seule s√©rie. Les s√©ries suppl√©mentaires ont √©t√© supprim√©es.
            </div>
            <span class="alert-close" onclick="this.parentElement.style.display='none'">‚úñ</span>
        </div>

        <!-- Formulaire -->
        <form method="post" onsubmit="prepareSeriesData(event)">
            {% csrf_token %}
            {{ graph_form.as_p }}

            <label><strong>Titre abscisses :</strong></label>
            <input type="text" id="titre-x" value="Titre des abscisses"><br>

            <label><strong>Titre ordonn√©es :</strong></label>
            <input type="text" id="titre-y" value="Titre des ordonn√©es"><br><br>

            <label><strong>Cat√©gories :</strong></label>
            <input type="text" id="categories-global" value="T1, T2, T3, T4" required><br><br>

            <h3>S√©ries de donn√©es</h3>
            <div id="series-container"></div>

            <button type="button" id="add-serie-btn" onclick="addSerie()">‚ûï Ajouter une s√©rie</button>
            <input type="hidden" name="series_data" id="series-data-json">
            <br><br>

            <button type="submit">‚úÖ Enregistrer</button>
        </form>
    </div>

    <!-- üìä Aper√ßu du graphique -->
    <div class="main-panel">
        <h3 id="preview-title">Aper√ßu du graphique</h3>
        <canvas id="preview-chart"></canvas>
    </div>
</div>

<!-- ‚úÖ Template de s√©rie √† cloner (hors de .sidebar pour √©viter le d√©calage) -->
<template id="serie-template">
    <div class="serie-block" style="border:1px solid #ccc;padding:10px;margin:10px 0;">
        <label>Nom :</label>
        <input type="text" class="serie-nom" value="Nom de la s√©rie"><br>

        <label>Valeurs :</label>
        <input type="text" class="serie-valeurs" value="10,20,40,50" required><br>

        <label>Couleur :</label>
        <input type="color" class="serie-couleur" value="#3e95cd"><br>

        <button type="button" onclick="this.parentElement.remove()">‚ùå</button>
    </div>
</template>

<!-- ‚úÖ Scripts charg√©s √† la fin (important !) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/chart_utils.js' %}"></script>
<script src="{% static 'js/graph_preview.js' %}"></script>
<script src="{% static 'js/prepare_series.js' %}"></script>


{% endblock %}
